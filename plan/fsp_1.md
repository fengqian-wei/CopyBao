# 文件发送协议（FSP） 0.1

此协议负责完成主机向客户机的文件传输。它建立在_数据传输协议_之上，使用数据传输协议发送数据包。

**大文件**的含义是超过512kB的文件。协议的实现可以拒绝传输大文件。

## 格式

一共两种数据包：

1.文件信息包

```
ffilename|size
```

2.文件内容包

```
dxxxx
```

其中：
- 前导的<code>f</code>和<code>d</code>表示数据包类型。
- filename表示文件名。
- size是十进制表示的文件大小，单位是字节。
- xxxx是不定长的base64编码串，表示文件内容。

## 语义

接收方收到_文件数据包_，就提取文件名和文件大小，在D盘（覆盖）创建一个此文件名的文件并以只写方式打开。此外，记录文件大小，宣告接收开始。

如果此前有已经打开的文件，那么关闭并删除它。

接收方收到_文件内容包_，就用base64解码，把解码后的数据写入文件，累计字节数，如果已经达到预定大小，那么关闭文件，并宣告接收成功。

## 操作细节

发送方首先传送文件信息，成功后，以512字节为单位，传送文件内容。最后若不足512字节，原数传送最后那些字节即可，无需补全。

## 实现建议

发送方应该有进度显示，即显示当前是在传送第几个512字节块。

由于直接的发送是由下层协议完成的，不应关注具体发送的字节数，所以发送方无需显示。接收方可以用显示的反复切换来表示有按键输入，比如每接收一次按键，就循环切换<code>\\|/-</code>中的下一字符来显示。
